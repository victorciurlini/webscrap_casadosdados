FROM ubuntu:20.04

LABEL maintainer="Victor Ciurlino <victorciurlino@gmail.com>"
LABEL version="1.0"
LABEL description="Deploy do projeto de webscrapper"

# Define o token de acesso pessoal (PAT)
ARG GITHUB_TOKEN

# Instala as dependências necessárias
RUN apt-get update && \
    apt-get install -y software-properties-common && \
    add-apt-repository ppa:deadsnakes/ppa && \
    apt-get update

# Instala o git
RUN apt-get install -y git

# Clona o repositório privado usando o token de acesso pessoal
RUN git clone https://${GITHUB_TOKEN}:x-oauth-basic@github.com/victorciurlini/webscrap_casadosdados.git /app

# instala o pip3 e o virtualenv
RUN apt-get install -y python3-pip
RUN apt install python3.8-venv -y && \
    pip3 install virtualenv && \
    virtualenv /app/.pyenv

# Copia requirements.txt e instala bibliotecas no python3.7
COPY requirements.txt /tmp/

RUN /bin/bash -c "source /app/.pyenv/bin/activate && \
                  pip install --upgrade pip && \
                  pip install --no-cache-dir -r /tmp/requirements.txt && \
                  pip install psycopg2-binary"

# Limpa o cache do apt-get
RUN apt-get clean && \
    rm -rf /var/lib/apt/lists/*

RUN echo "source /app/.pyenv/bin/activate" >> ~/.bashrc

# Define o diretório de trabalho
WORKDIR /app

#Inicia o container com o bash
CMD ["/bin/bash"]




